<div class="dashboard-container" [class.collapsed]="isSidebarCollapsed()">
  <aside class="sidebar">
    <button class="toggle-btn" (click)="toggleSidebar()">☰</button>
    @if (!isSidebarCollapsed()) {
      <nav>
        <p class="sidebar-title">TIPOS</p>
        <ul>
          <li (click)="filtrarPorTipo('todos')" [class.active]="tipoActivo() === 'todos'">
            <span class="type-dot" style="background-color: white; border: 1px solid #ccc;"></span>
            Todos
          </li>
          @for (tipo of tiposDisponibles; track tipo) {
            <li (click)="filtrarPorTipo(tipo)" [class.active]="tipoActivo() === tipo">
              <span class="type-dot" [style.background-color]="typeColors[tipo]"></span>
              {{ tipo | titlecase }}
            </li>
          }
        </ul>
      </nav>
    }
  </aside>

  <main class="main-content">
    <div class="pokedex-header">
  <div class="header-top">
    <h1>POKÉDEX</h1>
    <div class="type-counter">
      {{ tipoActivo() === 'todos' ? 'TOTAL' : (tipoActivo() | uppercase) }} 
      <span>{{ totalResultados() }}</span>
    </div>
  </div>
  <div class="header-line"></div>
</div>

    <header class="search-bar" [style.display]="selectedPokemon() ? 'none' : 'flex'">
      <input #pokemonInput type="text" placeholder="Busca nombre o ID..." (keyup.enter)="buscarPokemon(pokemonInput.value)">
      <button (click)="buscarPokemon(pokemonInput.value)">Buscar</button>
    </header>

    @if (selectedPokemon()) {
      <div class="detail-view">
        <button class="back-btn" (click)="cerrarDetalle()">← Volver</button>
        <div class="detail-container" [style.background-color]="getPokemonColor(selectedPokemon())">
          <div class="pokeball-bg large"></div>
          <div class="stats-column">
            <h2>{{ selectedPokemon().name | titlecase }}</h2>
            <div class="types-container">
              @for (t of selectedPokemon().types; track t.type.name) {
                <span class="type-badge" [class]="t.type.name">{{ t.type.name }}</span>
              }
            </div>
            <p>Altura: {{ selectedPokemon().height / 10 }}m | Peso: {{ selectedPokemon().weight / 10 }}kg</p>
          </div>
          <div class="image-column">
            <img [src]="selectedPokemon().sprites.other['official-artwork'].front_default">
          </div>
          <div class="stats-column">
            <h3>Stats</h3>
            @for (s of selectedPokemon().stats; track s.stat.name) {
              <div class="stat-bar">
                <span>{{ s.stat.name | uppercase }}: {{ s.base_stat }}</span>
                <div class="progress"><div class="fill" [style.width.%]="s.base_stat"></div></div>
              </div>
            }
          </div>
        </div>
      </div>
    }

    <div class="pokemon-grid" [style.display]="selectedPokemon() ? 'none' : 'grid'">
      
      @if (isLoading() && pokemonList().length === 0) {
        <div class="loading-state">
          <div class="pokeball-loader"></div>
          <p>CARGANDO DATOS...</p>
        </div>
      }

      @for (p of pokemonList(); track p.id) {
        <div class="pokemon-card" (click)="verDetalle(p)" [style.background-color]="getPokemonColor(p)">
          <div class="pokeball-bg"></div>
          <span class="pokemon-id">#{{ p.id }}</span>
          <h3>{{ p.name | titlecase }}</h3>
          <div class="types-container">
            @for (t of p.types; track t.type.name) {
              <span class="type-badge" [class]="t.type.name">{{ t.type.name }}</span>
            }
          </div>
          <img [src]="p.sprites.other['official-artwork'].front_default" loading="lazy">
        </div>
      }
    </div>

    @if (!selectedPokemon() && tipoActivo() !== 'Búsqueda') {
      <div class="pagination-controls">
        <button (click)="anteriorPagina()" [disabled]="paginaActual() === 0 || isLoading()">ANTERIOR</button>
        <div class="page-info">
          <span>PÁGINA {{ paginaActual() + 1 }} DE {{ totalPaginas() }}</span>
        </div>
        <button (click)="siguientePagina()" [disabled]="(paginaActual() + 1) * pokemonPorPagina >= totalResultados() || isLoading()">SIGUIENTE</button>
      </div>
    }
  </main>
</div>